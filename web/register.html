!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Inscription – La Palette (démo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
    }
    header {
      background: #e0001a;
      color: #fff;
      padding: 0.75rem 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      letter-spacing: 0.03em;
    }
    #cart-header button {
      border: none;
      background: #0070f3;
      color: #fff;
      padding: 0.35rem 0.75rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .container {
      max-width: 480px;
      margin: 2.5rem auto;
      padding: 0 1rem;
    }
    .card {
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
      padding: 1.25rem 1.5rem 1.5rem;
      font-size: 0.9rem;
    }
    h1 {
      margin-top: 0;
      font-size: 1.2rem;
      margin-bottom: 0.75rem;
    }
    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }
    input[type="email"],
    input[type="password"],
    input[type="text"] {
      width: 100%;
      padding: 0.4rem 0.5rem;
      font-size: 0.95rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      margin-bottom: 0.75rem;
      box-sizing: border-box;
    }
    select {
      width: 100%;
      padding: 0.35rem 0.5rem;
      font-size: 0.9rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      margin-bottom: 0.75rem;
    }
    button[type="submit"] {
      border: none;
      background: #0070f3;
      color: #fff;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .status {
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }
    .status.error { color: #b71c1c; }
    .status.ok { color: #1b5e20; }
    .hint {
      font-size: 0.8rem;
      color: #555;
      margin-top: 0.75rem;
    }
    .hint a {
      color: #0070f3;
      text-decoration: none;
    }
    .hint a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <div>La Palette – Dev Shop</div>
    <div id="cart-header">
      <select id="role-header-select" style="margin-right:0.75rem; font-size:0.8rem; padding:0.15rem 0.35rem; border-radius:4px; border:none;">
        <option value="">Choisir un espace  (rôle démo)</option>
        <option value="CLIENT">Client</option>
        <option value="SHOP">Magasin (Shop)</option>
        <option value="ADMIN">Administration</option>
        <option value="DELIVERY">Livraison</option>
      </select>
      <button id="presentation-header-btn" type="button" style="margin-right:0.5rem;">Présentation</button>
      <button id="myorders-header-btn" type="button" style="margin-right:0.5rem;">Mes commandes</button>
      <button id="profile-header-btn" type="button" style="margin-right:0.5rem;">Mon profil</button>
      <button id="login-header-btn" type="button">Login</button>
    </div>
  </header>

  <div class="container">
    <div class="card">
      <h1>Créer un compte (démo)</h1>
      <p style="font-size:0.85rem; margin-top:0; margin-bottom:0.75rem;">
        Cette page illustre un formulaire d'inscription. Dans cette version démo, 
        aucun vrai compte n'est créé dans la base : les données restent locales.
      </p>

      <form id="register-form">
        <label for="reg-role">Type de compte souhaité</label>
        <select id="reg-role">
          <option value="CLIENT">Client</option>
          <option value="SHOP">Magasin (Shop)</option>
          <option value="ADMIN">Administration</option>
        </select>

        <label for="reg-name">Nom complet</label>
        <input id="reg-name" type="text" />

        <label for="reg-email">Adresse e-mail</label>
        <input id="reg-email" type="email" autocomplete="email" />

        <label for="reg-phone">Téléphone</label>
        <input id="reg-phone" type="text" autocomplete="tel" />

        <label for="reg-company">Société / Raison sociale</label>
        <input id="reg-company" type="text" />

        <label for="reg-address">Adresse (facturation)</label>
        <input id="reg-address" type="text" />

        <label for="reg-customer-code">Code client (interne)</label>
        <input id="reg-customer-code" type="text" />

        <label for="reg-vat-number">N° de TVA (facultatif)</label>
        <input id="reg-vat-number" type="text" />

        <label for="reg-siret">N° SIRET (facultatif)</label>
        <input id="reg-siret" type="text" />

        <label for="reg-ape">Code APE (facultatif)</label>
        <input id="reg-ape" type="text" />

        <label for="reg-password">Mot de passe</label>
        <input id="reg-password" type="password" autocomplete="new-password" />

        <label for="reg-password2">Mot de passe (confirmation)</label>
        <input id="reg-password2" type="password" autocomplete="new-password" />

        <button type="submit">Créer mon compte (démo)</button>
        <div id="reg-status" class="status"></div>
      </form>

      <div class="hint">
        Déjà un compte démo ? <a href="login.html">Se connecter</a>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Shared header navigation (same logic as other pages)
      var loginBtn = document.getElementById('login-header-btn');
      if (loginBtn) {
        loginBtn.addEventListener('click', function () {
          window.location.href = 'login.html';
        });
      }

      var roleSelect = document.getElementById('role-header-select');
      if (roleSelect) {
        try {
          var rawUser = window.localStorage.getItem('lp_auth_user');
          if (rawUser) {
            var u = JSON.parse(rawUser) || {};
            if (u.role) {
              var r = String(u.role).toUpperCase();
              if (r === 'CLIENT') roleSelect.value = 'CLIENT';
              else if (r === 'SHOP') roleSelect.value = 'SHOP';
              else if (r === 'ADMIN') roleSelect.value = 'ADMIN';
            }
          }
        } catch (e) {}

        roleSelect.addEventListener('change', function () {
          var value = roleSelect.value;
          if (!value) return;
          if (value === 'CLIENT') {
            window.location.href = 'index.html';
          } else if (value === 'SHOP' || value === 'ADMIN') {
            window.location.href = 'orders.html';
          } else if (value === 'DELIVERY') {
            window.location.href = 'delivery-list.html';
          }
        });
      }

      var presentationBtn = document.getElementById('presentation-header-btn');
      if (presentationBtn) {
        presentationBtn.addEventListener('click', function () {
          window.location.href = 'presentation.html';
        });
      }

      var myOrdersBtn = document.getElementById('myorders-header-btn');
      if (myOrdersBtn) {
        myOrdersBtn.addEventListener('click', function () {
          window.location.href = 'index.html';
        });
      }

      var profileBtn = document.getElementById('profile-header-btn');
      if (profileBtn) {
        profileBtn.addEventListener('click', function () {
          window.location.href = 'profile.html';
        });
      }
    })();
  </script>

  <script>
    (function () {
      var form = document.getElementById('register-form');
      var statusEl = document.getElementById('reg-status');

      function setStatus(msg, type) {
        if (!statusEl) return;
        statusEl.textContent = msg || '';
        statusEl.className = 'status' + (type ? ' ' + type : '');
      }

      if (form) {
        form.addEventListener('submit', function (e) {
          e.preventDefault();
          var role = document.getElementById('reg-role').value || 'CLIENT';
          var name = (document.getElementById('reg-name').value || '').trim();
          var email = (document.getElementById('reg-email').value || '').trim();
          var phone = (document.getElementById('reg-phone').value || '').trim();
          var company = (document.getElementById('reg-company').value || '').trim();
          var address = (document.getElementById('reg-address').value || '').trim();
          var customerCode = (document.getElementById('reg-customer-code').value || '').trim();
          var vatNumber = (document.getElementById('reg-vat-number').value || '').trim();
          var siret = (document.getElementById('reg-siret').value || '').trim();
          var apeCode = (document.getElementById('reg-ape').value || '').trim();
          var pwd1 = (document.getElementById('reg-password').value || '').trim();
          var pwd2 = (document.getElementById('reg-password2').value || '').trim();

          if (!name || !email || !pwd1 || !pwd2) {
            setStatus('Merci de remplir tous les champs obligatoires (démo).', 'error');
            return;
          }
          if (pwd1.length < 4) {
            setStatus('Le mot de passe doit contenir au moins 4 caractères (démo).', 'error');
            return;
          }
          if (pwd1 !== pwd2) {
            setStatus('Les deux mots de passe ne correspondent pas.', 'error');
            return;
          }

          // Demo-only: we simply store a preview of the registration data in localStorage
          // so it peut être montré lors de la présentation, sans créer un vrai compte.
          try {
            var demoReg = { role: role, name: name, email: email, createdAt: new Date().toISOString() };
            window.localStorage.setItem('lp_demo_last_registration', JSON.stringify(demoReg));
          } catch (e) {}

          // NEW: also send basic profile info to backend customers table (Neon)
          try {
            fetch('http://localhost:3002/api/customers/register', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                email: email,
                name: name,
                phone: phone,
                companyName: company,
                address: address,
                customerCode: customerCode,
                vatNumber: vatNumber,
                siret: siret,
                apeCode: apeCode
              })
            }).catch(function (err) {
              console.error('Failed to sync registration with backend (demo)', err);
            });
          } catch (e) {
            console.error('Unexpected error while syncing registration (demo)', e);
          }

          setStatus('Inscription enregistrée côté navigateur (démo). Redirection vers la page de connexion…', 'ok');

          // After a short delay, send the user back to the login page
          setTimeout(function () {
            window.location.href = 'login.html';
          }, 800);
        });
      }
    })();
  </script>
</body>
</html>
